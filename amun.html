<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø±Ø¬Ù„ Ø§Ù„ÙØ¶Ø§Ø¡ - Ù†Ø³Ø®Ø© Ø§Ù„Ù‡Ø§ØªÙ</title>
    <style>
        /* Ù…Ù†Ø¹ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…ØªØµÙØ­ Ù…Ø«Ù„ Ø§Ù„ØªÙƒØ¨ÙŠØ± ÙˆØ§Ù„Ø³Ø­Ø¨ */
        * {
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #0b0d17; 
            font-family: sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            color: white; 
        }

        #game-container { 
            position: relative; 
            width: 100vw; 
            height: 100vh;
            max-width: 800px;
            max-height: 400px;
        }

        canvas { 
            background: radial-gradient(circle, #1e293b 0%, #0f172a 100%); 
            display: block; 
            width: 100%;
            height: 100%;
        }
        
        .overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            display: none; flex-direction: column; justify-content: center; 
            align-items: center; background: rgba(0,0,0,0.8); text-align: center; z-index: 10; 
        }

        #stats { 
            position: absolute; top: 5px; width: 100%; 
            display: flex; justify-content: space-around; 
            font-size: clamp(12px, 4vw, 18px); font-weight: bold; pointer-events: none; 
        }
        
        button { 
            padding: 15px 30px; font-size: 18px; background: #38bdf8; 
            border: none; border-radius: 8px; cursor: pointer; font-weight: bold; 
            margin: 10px; color: #0f172a; 
        }

        #pause-btn { 
            position: absolute; top: 40px; right: 10px; 
            background: rgba(148, 163, 184, 0.5); color: white; 
            padding: 10px; border-radius: 5px; cursor: pointer; z-index: 5;
        }

        #shop-btn { 
            position: absolute; bottom: 10px; right: 10px; 
            background: #fbbf24; color: #000; padding: 12px 20px; 
            border-radius: 50px; cursor: pointer; font-weight: bold; z-index: 5;
        }
        
        #shop-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        .skin-item { border: 2px solid #444; padding: 5px; border-radius: 8px; background: #1e293b; font-size: 12px; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="stats">
            <div id="score-txt">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: 1</div>
            <div id="coins-txt">ğŸ’° 0</div>
            <div id="shield-txt" style="color:#38bdf8">ğŸ›¡ï¸</div>
        </div>
        
        <div id="pause-btn" onclick="togglePause()">â¸ï¸</div>
        <canvas id="gameCanvas"></canvas>
        <div id="shop-btn" onclick="toggleShop()">ğŸ›’</div>

        <div id="pause-screen" class="overlay">
            <h1>Ù…ØªÙˆÙ‚Ù</h1>
            <button onclick="togglePause()">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
        </div>

        <div id="death-screen" class="overlay">
            <h1>ØªØ­Ø·Ù…Øª!</h1>
            <p id="final-stats"></p>
            <button onclick="resetGame()">Ø­Ø§ÙˆÙ„ Ø«Ø§Ù†ÙŠØ©</button>
        </div>

        <div id="shop-screen" class="overlay">
            <h2>Ø§Ù„Ù…ØªØ¬Ø±</h2>
            <div id="shop-grid"></div>
            <button onclick="toggleShop()" style="background:#ef4444">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        
        // Ø£Ø¨Ø¹Ø§Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø«Ø§Ø¨ØªØ© Ù„Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ
        const GAME_WIDTH = 800;
        const GAME_HEIGHT = 400;
        canvas.width = GAME_WIDTH;
        canvas.height = GAME_HEIGHT;

        let level = 1, coins = parseInt(localStorage.getItem('coins')) || 0;
        let gameActive = false, isPaused = false; 
        let obstacles = [], frameCount = 0, distanceToFlag = 2000;
        let currentSkin = localStorage.getItem('selectedSkin') || "#f8fafc";
        let ownedSkins = JSON.parse(localStorage.getItem('ownedSkins')) || ["#f8fafc"];
        let hasShield = false;

        const skins = [
            { name: "Ø£Ø¨ÙŠØ¶", color: "#f8fafc", price: 0 },
            { name: "Ø£Ø®Ø¶Ø±", color: "#22c55e", price: 30 },
            { name: "Ø°Ù‡Ø¨ÙŠ", color: "#fbbf24", price: 100 }
        ];

        let player = { x: 80, y: 200, width: 35, height: 45, gravity: 0.6, velocity: 0, up: false };

        function init() {
            obstacles = []; frameCount = 0;
            distanceToFlag = 2000 + (level * 500);
            player.y = 200; player.velocity = 0;
            hasShield = false; gameActive = true; isPaused = false;
            document.querySelectorAll('.overlay').forEach(el => el.style.display = "none");
            updateUI();
            requestAnimationFrame(gameLoop);
        }

        function drawAstronaut() {
            ctx.save();
            ctx.translate(player.x + player.width/2, player.y + player.height/2);
            if (player.up) ctx.scale(1, -1);
            if (hasShield) {
                ctx.strokeStyle = "#38bdf8"; ctx.lineWidth = 3; ctx.beginPath();
                ctx.arc(0, 0, 35, 0, Math.PI * 2); ctx.stroke();
            }
            ctx.fillStyle = "#64748b"; ctx.fillRect(-22, -15, 10, 30);
            ctx.fillStyle = currentSkin; ctx.beginPath(); ctx.roundRect(-15, -20, 30, 40, 8); ctx.fill();
            ctx.fillStyle = "#0ea5e9"; ctx.beginPath(); ctx.roundRect(-5, -15, 18, 15, 5); ctx.fill();
            ctx.restore();
        }

        function togglePause() {
            if (!gameActive) return;
            isPaused = !isPaused;
            document.getElementById("pause-screen").style.display = isPaused ? "flex" : "none";
            if (!isPaused) requestAnimationFrame(gameLoop);
        }

        function gameLoop() {
            if (!gameActive || isPaused) return;
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

            player.velocity += player.up ? -player.gravity : player.gravity;
            player.y += player.velocity;

            if (player.y < 0) { player.y = 0; player.velocity = 0; }
            if (player.y + player.height > GAME_HEIGHT) { player.y = GAME_HEIGHT - player.height; player.velocity = 0; }

            distanceToFlag -= (5 + level);
            if (distanceToFlag < 400) { ctx.fillStyle = "#ef4444"; ctx.fillRect(distanceToFlag, 0, 10, GAME_HEIGHT); }
            if (distanceToFlag <= player.x) { level++; coins += 20; init(); return; }

            if (frameCount % Math.max(40, 90 - (level*5)) === 0 && distanceToFlag > 500) {
                let h = Math.random() * 150 + 50;
                let type = Math.random() > 0.5 ? "top" : "bottom";
                obstacles.push({ x: GAME_WIDTH, y: type === "top" ? 0 : GAME_HEIGHT-h, w: 50, h: h });
            }

            obstacles.forEach((obs, i) => {
                obs.x -= (5 + level);
                ctx.fillStyle = "#475569"; ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
                if (player.x < obs.x + obs.w && player.x + player.width > obs.x && player.y < obs.y + obs.h && player.y + player.height > obs.y) {
                    gameOver();
                }
                if (obs.x + obs.w < 0) obstacles.splice(i, 1);
            });

            drawAstronaut();
            frameCount++;
            requestAnimationFrame(gameLoop);
        }

        function updateUI() {
            document.getElementById("score-txt").innerText = "Ø§Ù„Ù…Ø±Ø­Ù„Ø©: " + level;
            document.getElementById("coins-txt").innerText = "ğŸ’° " + coins;
            document.getElementById("shield-txt").innerText = hasShield ? "ğŸ›¡ï¸ Ù†Ø´Ø·" : "ğŸ›¡ï¸";
            localStorage.setItem('coins', coins);
        }

        function gameOver() { gameActive = false; document.getElementById("death-screen").style.display = "flex"; document.getElementById("final-stats").innerText = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${level}`; level = 1; }
        
        function toggleShop() { 
            if (gameActive && !isPaused) togglePause();
            const s = document.getElementById("shop-screen"); 
            s.style.display = s.style.display === "flex" ? "none" : "flex"; 
            renderShop(); 
        }

        function renderShop() {
            const grid = document.getElementById("shop-grid"); grid.innerHTML = "";
            skins.forEach(skin => {
                const isOwned = ownedSkins.includes(skin.color);
                grid.innerHTML += `<div class="skin-item" onclick="buySkin('${skin.color}', ${skin.price})">
                    <div style="background:${skin.color}; width:20px; height:20px; margin:auto; border-radius:50%"></div>
                    <p>${isOwned ? 'Ø§Ù…ØªÙ„Ùƒ' : skin.price + 'ğŸ’°'}</p></div>`;
            });
        }

        function buySkin(color, price) {
            if (ownedSkins.includes(color)) { currentSkin = color; localStorage.setItem('selectedSkin', color); }
            else if (coins >= price) { 
                coins -= price; ownedSkins.push(color); currentSkin = color; 
                localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins)); 
                localStorage.setItem('selectedSkin', color); updateUI(); 
            }
            toggleShop();
        }

        function resetGame() { init(); }

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
        const handleAction = (e) => {
            e.preventDefault();
            if (!isPaused && gameActive) player.up = !player.up;
        };

        canvas.addEventListener("touchstart", handleAction, {passive: false});
        canvas.addEventListener("mousedown", (e) => {
            if (e.button === 0) handleAction(e);
        });

        window.addEventListener("keydown", (e) => { 
            if (e.code === "Space") handleAction(e);
            if (e.key.toLowerCase() === "p") togglePause();
        });

        init();
    </script>
</body>
</html>